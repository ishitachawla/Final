import * as core from '@actions/core';
import { Octokit } from '@octokit/core';

export async function vulnerabilityBotCheck(repository: string, ownername: string, secret_token: string, octokit: Octokit) {
    try{
      const result = await octokit.request('GET /repos/{owner}/{repo}/vulnerability-alerts',{
        repo: repository,
        owner: ownername,
        headers : { 
          Authorization: 'Bearer ' + secret_token,
        },
        mediaType: {
          previews: [
            'dorian'
          ]
        }
      }); 
      if(result.status == 204){
        console.log('Vulnerability bot is enabled');
      }
      else{
        core.setFailed('Please enable vulnerability bot');
      }
    }
    catch(err){
      core.setFailed('Please enable vulnerability bot');
    }
}